<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
</head>

<body>
  <div class="container">
    <div class="row mt-4">
      <div class="col-md-5">
        <form action="" id="formRegistrar">
          <div class="mb-3">
            <label for="modelo" class="form-label">Marca</label>
            <select required class="form-select" name="marca" aria-label="Default select example">
              <option value="chevrolet">Chevrolet</option>
              <option value="toyota">Toyota</option>
              <option value="kia">Kia</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="modelo" class="form-label">modelo</label>
            <input type="text" name="modelo" class="form-control" id="modelo" required />
          </div>
          <div class="mb-3">
            <label for="precio" class="form-label">precio</label>
            <input required type="text" name="precio" class="form-control" id="precio" />
          </div>
          <div class="mb-3">
            <label for="tipocombustible" class="form-label">tipo Combustible</label>
            <select required class="form-select" name="tipocombustible"  id="tipocombustible" aria-label="Default select example">
              <option value="Gasolina premiun">Gasolina premiun</option>
              <option value="Gasolina Regular">Gasolina Regular</option>
              <option value="GNV">GNV</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="precio" class="form-label">Color</label>
            <input required type="text" name="color" class="form-control" id="precio" />
          </div>
          <div class="row">
            <button type="button" class="btn btn-success" id="guardar">
              Registrar
            </button>
          </div>
        </form>
      </div>
      <div class="col-md-7">
        <table id="tbautos" class="table table-stripe table-sm">
          <thead>
            <tr>
              <th>Marca</th>
              <th>Modelo</th>
              <th>Precio</th>
              <th>T Combustible</th>
              <th>color</th>
              <th>acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
  <!-- Modal Body -->
  <div class="modal fade" id="modal-auto" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" role="dialog"
    aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header bg-primary text-light">
          <h5 class="modal-title" id="modalTitleId">Actualizar datos</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="form-editar">
            <form action="" id="formRegistrar">
              <div class="mb-3">
                <label for="modelo" class="form-label">Marca</label>
                <select required class="form-select" name="marca" aria-label="Default select example" id="marcae">
                  <option value="chevrolet">Chevrolet</option>
                  <option value="toyota">Toyota</option>
                  <option value="kia">Kia</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="modelo" class="form-label">modelo</label>
                <input type="text" name="modelo" class="form-control" id="modeloe" required />
              </div>
              <div class="mb-3">
                <label for="precio" class="form-label">precio</label>
                <input required type="text" name="precio" class="form-control" id="precioe" />
              </div>
              <div class="mb-3">
                <label for="tipocombustiblee" class="form-label">tipo Combustible</label>
                <select required class="form-select" name="tipocombustible" id="tipocombustiblee" aria-label="Default select example">
                  <option value="Gasolina premiun">Gasolina premiun</option>
                  <option value="Gasolina Regular">Gasolina Regular</option>
                  <option value="GNV">GNV</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="precio" class="form-label">Color</label>
                <input required type="text" name="color" class="form-control" id="colore" />
              </div>
            </form>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">
            Close
          </button>
          <button type="button" id="editar" class="btn btn-primary btn-sm">
            Actualizar
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- fin modales -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
  
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const $ = (selector) => document.querySelector(selector);
      const $tabla = $("#tbautos");
      const $tablacuerpo = $("#tbautos tbody");
      const $btnGuardar = $("#guardar");
      const $frmRegistrar = $("#formRegistrar");
      const $frmEditar = $("#form-editar")
      const $modal = new bootstrap.Modal(
          document.querySelector("#modal-auto")
        );
      const $btnActualizar = $("#editar");
      let idautomovil = 0;


      function obtenerautomoviles() {
        const data = new URLSearchParams();
        data.append("operacion", "listar");
        $tablacuerpo.innerHTML = "";

        fetch("../controllers/automovil.controller.php", {
          method: "POST",
          body: data,
        })
          .then((res) => res.json())
          .then((data) => {
            data.forEach((auto) => {
              $tablacuerpo.innerHTML += `
                <tr>
                  <td>
                    ${auto.marca}
                  </td>
                  <td>
                    ${auto.modelo}
                  </td>
                  <td>
                    ${auto.precio}
                  </td>
                  <td>
                    ${auto.tipocombustible}
                  </td>
                  <td>
                    ${auto.color}
                  </td>
                  <td>
                    <a class="btn btn-danger btn-sm eliminar" data-id="${auto.idautomovil}">eliminar</a>
                    <a class="btn btn-primary btn-sm editar" data-id="${auto.idautomovil}">editar</a>
                  </td>
                </tr>
              `;
            });
          });
      }

      $btnGuardar.addEventListener("click", () => {
        const data = new FormData($frmRegistrar);
        data.append("operacion", "registrar");

        fetch("../controllers/automovil.controller.php", {
          method: "POST",
          body: data,
        })
          .then((res) => res.json())
          .then((data) => {
            $frmRegistrar.reset();
            obtenerautomoviles();
          });
      });

      $tablacuerpo.addEventListener("click", (e) => {
        const $currentElement = e.target.closest(".eliminar");
        if ($currentElement) {
          idautomovil = $currentElement.dataset.id;
          if (confirm("deseas eliminar")) {
            const data = new URLSearchParams();
            data.append("operacion", "eliminar");
            data.append("idautomovil", idautomovil);
            fetch("../controllers/automovil.controller.php", {
              method: "POST",
              body: data,
            })
              .then((res) => res.json())
              .then((datos) => {
                if (datos.status) {
                  obtenerautomoviles();
                } else {
                  alert("no se puede eliminar");
                }
              });
          }
        }
      });

      $tablacuerpo.addEventListener("click", (e) => {
        const $currentElement = e.target.closest(".editar");
        if ($currentElement) {
          idautomovil = $currentElement.dataset.id;
          const data = new URLSearchParams();
          data.append("operacion", "buscar");
          data.append("idautomovil", idautomovil);

          fetch("../controllers/automovil.controller.php", {
            method: "POST",
            body: data,
          })
            .then((res) => res.json())
            .then((datos) => {
              console.log(datos)
             $("#marcae").value = datos.marca
             $("#modeloe").value = datos.modelo
             $("#tipocombustiblee").value = datos.tipocombustible
             $("#colore").value = datos.color
             $("#precioe").value = datos.precio
            });

          $modal.toggle();
        }
      });

      $btnActualizar.addEventListener("click", () =>{
        const formData = new FormData($frmEditar);
        formData.append("operacion", "editar");
        formData.append("idautomovil", idautomovil);
        fetch("../controllers/automovil.controller.php", {
          method: "POST",
          body: formData,
        })
          .then((res) => res.json())
          .then((data) => {
            $frmEditar.reset();
            obtenerautomoviles();
            $modal.toggle();
          });
      })
      $modal._element.addEventListener("shown.bs.modal", () => {
          $("#marcae").focus();
        });

       /*  modal._element.addEventListener("hidden.bs.modal", () => {
          $("#form-editar").reset();
          idProducto = 0;
        }); */
      obtenerautomoviles();
    });
  </script>
</body>

</html>